var timeCodeString = '2017-04-01T12:00+02:00';
var initRiddles = [
	{},
	{
		"answer": null,
		"urlHash": "ef75p0l-4oMOhE7tXu5KntByYjUJ_suY",
		"urlVerification": {
			"salt": "f1b003ea248e2ad9d31572205788a585cf7062ebaacb2c21",
			"hash": "1e30ce9541a6b586893c84b3dd2c2bc66f22586b47fc5ccc"
		},
		"answerVerification": {
			"salt": "cfd2d2b1ca7237ec7d922ab0a115ca3c249ece3ca4180900",
			"hash": "5847b958e599f08be3f8570950b282836e34848418fc855c"
		},
		"nextUrlSalt": "b2e5e544e4753d39c751856d95c3755b4a69da07de080a58",
		"wrongAnswers": []
	},
	{
		"answer": null,
		"urlHash": null,
		"urlVerification": {
			"salt": "42071ab6651f55b132716bb7643bdf7903151bab04417601",
			"hash": "60cf073d5cb3eff74927cb60bb069207fa7f6f6d2817d12b"
		},
		"answerVerification": {
			"salt": "c57c0970fda20615c2b7ed6acd8a3dac466b77e823b5f601",
			"hash": "1f0e82d0245f1c7465e1a99a6e0e7606a75c51bedc7a125d"
		},
		"nextUrlSalt": "52d4cb578c5b08b56bbc64c40dae304574863b192c1f2bd6",
		"wrongAnswers": []
	},
	{
		"answer": null,
		"urlHash": "4L73xsiDJSTZ9S0uTOL7elV4UwKuAOIb",
		"urlVerification": {
			"salt": "d4820629c55d4c153866917c2a67d82fe2ab33323ac407e7",
			"hash": "062ef674472e98d02cebfebd01b84d8cf9b4062dd088eea1"
		},
		"answerVerification": {
			"salt": "64b3d0585865f20869bd8520c36f8f0a45ba0bf5ccd455a0",
			"hash": "1166ed785d2b05366c99c0d22da51159a329eb7415c6eeb3"
		},
		"nextUrlSalt": "a4fa5b30893d49c90e0cc984bdd68063408fa9d779dbb965",
		"wrongAnswers": []
	},
	{
		"answer": null,
		"urlHash": "Jec8C0RGkwJeAbNwJlvzVb_6BaciSHvI",
		"urlVerification": {
			"salt": "207910888168186e7bb6522fa06342f230db9e31e8bd2cd6",
			"hash": "45bd37cee437ee9e0f6090a8f8016b7b8751e9723660f6f6"
		},
		"answerVerification": {
			"salt": "f365ac2fffa035e113ff41ee39be505a3c8723fc09e3f419",
			"hash": "415f355fd5ed3e12a6e24e9fca24fb61916aca51b671511e"
		},
		"nextUrlSalt": "07614b2b3aa86ad7673009a2cd8952e48e475bf90d845b07",
		"wrongAnswers": []
	},
	{
		"answer": null,
		"urlHash": "byRS2uYE_1C9Dk2cJMneAwhpfB16ZtP8",
		"urlVerification": {
			"salt": "de8b84b52b2631478d5076d95591ca2b29f6e17a95b7f3a4",
			"hash": "735b6ad789940772ec9f83884a378224dc91c5eac672ef4b"
		},
		"answerVerification": {
			"salt": "7c44331b5e0b68c4259a2af1dcd90c4f5e891c80e34fc60c",
			"hash": "dbeb478aada043aee5f59721c362699930da4e94d97e30ce"
		},
		"nextUrlSalt": "bcd2981b709f6af82a2944df28c6504e2fde7b2f40411f95",
		"wrongAnswers": []
	},
	{
		"answer": null,
		"urlHash": "iB8X_BTMsqghLhlsMMST8CiVWWYFB63f",
		"urlVerification": {
			"salt": "2b4fa4a58ab53298daf2e305c1e5c7f9576fc337f994a3ef",
			"hash": "05338cc715f58b56de5570fbe4769d42913c63db539542af"
		},
		"answerVerification": {
			"salt": "cba27f1cb75c20c60855413a389bfd4ec0f7a55cf448a5c3",
			"hash": "7fe4e46d3fe453678bd3e69668d1bbf9c48d5d9db828d97d"
		},
		"nextUrlSalt": "6536865a8f667fea899dc857b26ac2cb7930e06186a197b1",
		"wrongAnswers": []
	},
	{
		"answer": null,
		"urlHash": "V13IJhKr8VUTXcbplAnGRF2-q26WcGpf",
		"urlVerification": {
			"salt": "b63543cbbae32b93567427b2058e515b2147bd4287eee59c",
			"hash": "b5e4a0b309dca0bf7c883e2f99b83ac672cf20b6ebafb818"
		},
		"answerVerification": {
			"salt": "da8bd1495430c9c8424c6b7116b91603c1d3ac26ca013cb0",
			"hash": "5ceab57423de9f254bed268395d1eb85e55dc5807c8f8ed4"
		},
		"nextUrlSalt": "8289099078c4fe58e82c1ec448b88446dbd9891632875179",
		"wrongAnswers": []
	},
	{
		"answer": null,
		"urlHash": "DDBvtfToezv7gslP-2gKo2pZ6A5V_h8f",
		"urlVerification": {
			"salt": "8636cee3722b081b96e9bfaf03fe3bf7083100c39483c692",
			"hash": "9378f9406f02e4fe4e147d4ed2cfb3841c10e2f816471c31"
		},
		"answerVerification": {
			"salt": "850bea2f06fee4a8f3039ac8af43e32241725ad085445e74",
			"hash": "612486b24cc68026e67fb5930ae0ebecc4ed9671cfe0af58"
		},
		"nextUrlSalt": "59444d06e4db8f7a0176464d5cf45413f9bda713711584a4",
		"wrongAnswers": []
	}
];


function generete(answers, links){
  var riddles = [{}];
  var nextUrlHash = hexToBitdo64(getSalt());

  function genereteRiddle(i){
    var riddle = {
      answer: null,
			imgUrl: null,
      urlHash: nextUrlHash,
      urlVerification: {
        salt: getSalt(), 
        hash: null
      },
      answerVerification: {
        salt: getSalt(),
        hash: null
      },
      nextUrlSalt: getSalt(),
      wrongAnswers: [],
    };

    /*return hash('https://bit.do/'+riddle.urlHash,riddle.urlVerification.salt)
    .then(function(hash1){
      riddle.urlVerification.hash = hash1;
    })
    .then(function(){return hash(answers[i],riddle.answerVerification.salt)})
    .then(function(hash2){
      riddle.answerVerification.hash = hash2;
    })
    .then(function(){return hash(answers[i],riddle.nextUrlSalt)})
    .then(function(hash3){
      nextUrlHash = hexToBitdo64(hash3);
      return riddle;
    });*/

    var p1 = hash(links[i],riddle.urlVerification.salt)
    .then(function f1(hash1){
      riddle.urlVerification.hash = hash1;
    })
    var p2 = hash(answers[i],riddle.answerVerification.salt)
    .then(function f2(hash2){
      riddle.answerVerification.hash = hash2;
    })
    var p3 = hash(answers[i],riddle.nextUrlSalt)
    .then(function f3(hash3){
      nextUrlHash = hexToBitdo64(hash3);
    });
    return Promise.all([p1,p2,p3]).then(function(){return riddle});
  }

  function generateNextRiddle(i){
    return genereteRiddle(i).then(function(riddle){
      riddles.push(riddle);
      if(i<answers.length-1){
        return generateNextRiddle(++i);
      }
      else{
        return riddles;
      }
    });
  }

  generateNextRiddle(0).then(function(riddles){
    console.log(JSON.stringify(riddles));
  })

}